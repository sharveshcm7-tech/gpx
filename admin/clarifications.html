{% extends 'admin/base_admin.html' %}
{% block title %}Clarifications â€” Admin Grand Prix{% endblock %}
{% block admin_content %}
<div class="page-header">
  <div class="page-title">CLARIFICATIONS</div>
  <div class="page-subtitle">Team questions and admin responses</div>
</div>

{% for c in clarifications %}
<div class="card mb-2" id="clarif-{{ c.id }}" style="{% if not c.answer %}border-color:rgba(255,214,0,0.4){% endif %}">
  <div style="display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:.75rem">
    <div style="flex:1">
      <div style="display:flex;gap:.5rem;align-items:center;margin-bottom:.5rem;flex-wrap:wrap">
        <span style="font-weight:700;font-size:.9rem">{{ c.team_name }}</span>
        {% if c.problem_title %}<span class="badge">{{ c.problem_title }}</span>{% endif %}
        {% if c.is_public %}<span class="badge green">Public</span>{% endif %}
        {% if not c.answer %}<span class="badge gold">Unanswered</span>{% endif %}
        <span class="text-xs text-muted">{{ c.created_at }}</span>
      </div>
      <div style="background:var(--surface2);border-radius:8px;padding:.75rem 1rem;margin-bottom:.75rem;font-size:.9rem">
        {{ c.question }}
      </div>
      {% if c.answer %}
      <div style="border-left:3px solid var(--green);padding:.75rem 1rem;font-size:.9rem;color:var(--green);background:rgba(0,230,118,0.05);border-radius:0 8px 8px 0">
        <div class="text-xs text-muted mb-1">Admin Response:</div>
        {{ c.answer }}
      </div>
      {% endif %}
    </div>
    <div>
      <button class="btn btn-primary btn-sm" onclick="openRespond({{ c.id }}, {{ c.is_public }}, `{{ c.answer|default('')|e }}`)">
        <i class="fas fa-reply"></i> {% if c.answer %}Update{% else %}Respond{% endif %}
      </button>
    </div>
  </div>
</div>
{% else %}
<div class="card" style="text-align:center;padding:4rem">
  <div style="font-size:3rem;margin-bottom:1rem">ðŸ’¬</div>
  <div style="font-weight:700">No clarifications yet</div>
  <div class="text-muted text-sm mt-1">Team questions will appear here</div>
</div>
{% endfor %}

<!-- Respond Modal -->
<div class="modal-overlay" id="respond-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Respond to Clarification</div>
      <button class="modal-close" onclick="closeModal('respond-modal')">âœ•</button>
    </div>
    <input type="hidden" id="clarif-id">
    <div class="form-group">
      <label class="form-label">Your Response</label>
      <textarea id="clarif-answer" class="form-control" rows="5" placeholder="Write your response..."></textarea>
    </div>
    <div class="form-group" style="display:flex;align-items:center;gap:.75rem">
      <input type="checkbox" id="is-public" style="width:18px;height:18px;accent-color:var(--red)">
      <label for="is-public" style="font-size:.9rem;cursor:pointer">Make this Q&A visible to all teams</label>
    </div>
    <div style="display:flex;gap:.75rem">
      <button class="btn btn-primary" style="flex:1;justify-content:center" onclick="submitResponse()">
        <i class="fas fa-paper-plane"></i> Send Response
      </button>
      <button class="btn btn-ghost" onclick="closeModal('respond-modal')">Cancel</button>
    </div>
  </div>
</div>
{% endblock %}
{% block extra_js %}
<script>
function openRespond(id, isPublic, existingAnswer){
  document.getElementById('clarif-id').value=id;
  document.getElementById('clarif-answer').value=existingAnswer||'';
  document.getElementById('is-public').checked=!!isPublic;
  openModal('respond-modal');
}

async function submitResponse(){
  const id=document.getElementById('clarif-id').value;
  const answer=document.getElementById('clarif-answer').value.trim();
  const is_public=document.getElementById('is-public').checked?1:0;
  if(!answer){showToast('Write a response first','error');return;}
  const r=await fetch(`/admin/clarifications/${id}/respond`,{
    method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({answer,is_public})
  });
  const d=await r.json();
  if(d.success){showToast('Response sent!','success');closeModal('respond-modal');setTimeout(()=>location.reload(),800);}
  else showToast('Error','error');
}
</script>
{% endblock %}