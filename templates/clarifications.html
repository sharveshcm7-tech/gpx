{% extends 'base.html' %}
{% block title %}Clarifications ‚Äî Grand Prix{% endblock %}
{% block content %}
<div style="max-width:900px;margin:0 auto;padding:2rem">
  <div class="page-header">
    <div class="page-title">CLARIFICATIONS</div>
    <div class="page-subtitle">Ask questions & view announcements</div>
  </div>

  <!-- Announcements -->
  {% if announcements %}
  <div class="card mb-3">
    <div class="card-title mb-2">üì¢ Announcements</div>
    {% for ann in announcements %}
    <div style="border-left:3px solid var(--red);padding:.75rem 1rem;margin-bottom:.5rem;background:rgba(255,23,68,0.05);border-radius:0 8px 8px 0">
      <div style="font-weight:700;margin-bottom:.25rem">{{ ann.title }}</div>
      <div style="color:var(--muted);font-size:.9rem">{{ ann.message }}</div>
      <div class="text-xs text-muted mt-1">{{ ann.created_at }}</div>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Ask Question -->
  <div class="card mb-3">
    <div class="card-title mb-2">üí¨ Ask a Question</div>
    <form id="clarif-form">
      <div class="form-group">
        <label class="form-label">Your Question</label>
        <textarea name="question" class="form-control" rows="4" placeholder="Describe your clarification clearly..." required></textarea>
      </div>
      <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Send Question</button>
    </form>
  </div>

  <!-- My Questions -->
  <div class="card mb-3">
    <div class="card-title mb-2">My Questions</div>
    {% for c in my_clarifs %}
    <div style="border:1px solid var(--border);border-radius:10px;padding:1rem;margin-bottom:.75rem">
      <div style="font-weight:600;margin-bottom:.5rem">{{ c.question }}</div>
      {% if c.problem_title %}<span class="badge" style="margin-bottom:.5rem">{{ c.problem_title }}</span>{% endif %}
      {% if c.answer %}
      <div style="border-top:1px solid var(--border);padding-top:.75rem;margin-top:.75rem">
        <div class="text-xs text-muted mb-1">Admin Response:</div>
        <div style="color:var(--green);font-size:.9rem">{{ c.answer }}</div>
      </div>
      {% else %}
      <div class="badge text-muted">Awaiting response...</div>
      {% endif %}
      <div class="text-xs text-muted mt-1">{{ c.created_at }}</div>
    </div>
    {% else %}
    <div class="text-muted text-sm">No questions asked yet.</div>
    {% endfor %}
  </div>

  <!-- Public Q&A -->
  {% if public %}
  <div class="card">
    <div class="card-title mb-2">üåç Public Q&A</div>
    {% for c in public %}
    <div style="border:1px solid var(--border);border-radius:10px;padding:1rem;margin-bottom:.75rem">
      <div style="font-weight:600;margin-bottom:.5rem">{{ c.question }}</div>
      {% if c.problem_title %}<span class="badge" style="margin-bottom:.5rem">{{ c.problem_title }}</span>{% endif %}
      {% if c.answer %}
      <div style="border-top:1px solid var(--border);padding-top:.75rem;margin-top:.75rem">
        <div class="text-xs text-muted mb-1">Admin:</div>
        <div style="color:var(--green);font-size:.9rem">{{ c.answer }}</div>
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% endif %}
</div>
{% endblock %}
{% block extra_js %}
<script>
document.getElementById('clarif-form').addEventListener('submit',async e=>{
  e.preventDefault();
  const q=e.target.question.value.trim();
  if(!q)return;
  const r=await fetch('/clarifications',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({question:q})});
  const d=await r.json();
  if(d.success){showToast('Question sent!','success');e.target.reset();setTimeout(()=>location.reload(),1500);}
  else showToast(d.error||'Error','error');
});
</script>
{% endblock %}